
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Source: gulpfile.js | Vialer-js</title>
    <link type="text/css" rel="stylesheet" href="styles/font-awesome.min.css">
    <link type="text/css" rel="stylesheet" href="styles/main.css">

    
</head>
<body>
<div class="main-container">
    <input type="checkbox" id="nav-trigger" class="nav-trigger">
    <label for="nav-trigger" class="navicon-button x">
      <div class="navicon"></div>
    </label>
    <label for="nav-trigger" class="overlay"></label>

    <nav class="lnb" id="lnb">
        <div class="nav-search js-search">
            <div class="logo" style="width: 72px; height: 72px">
                <img src="logo-64.png" width="100%" height="100%">
            </div>
            <input type="text" placeholder="Search docs">
            <ul class="searched-list"></ul>
        </div>

        <div class="nav-main">
            <h1><a href="index.html" class="link">Vialer-js</a></h1>
            <span class="version">
            
                v3.0.91
            
            </span>
        </div>

        
        <ol class="nav-tab">
            <li id="manuals-tab">
                <a href="#manuals"><h4>Manuals</h4></a>
            </li>
            <li id="api-tab">
                <a href="#api"><h4>Code</h4></a>
            </li>
        </ol>
        

        <div class="scroll">
        <div class="nav-manuals hidden"><h3>Manuals</h3><ul class="nav-items"><li class="nav-item">
                <span class="toggle-subnav invisible btn btn-link fa fa-plus"></span>
                <a href="tutorial-branding.html">Branding</a>
                <div class="nav-item-sub hidden" id="branding_sub"></div>
            </li><li class="nav-item">
                <span class="toggle-subnav invisible btn btn-link fa fa-plus"></span>
                <a href="tutorial-deployment.html">Deployment</a>
                <div class="nav-item-sub hidden" id="deployment_sub"></div>
            </li><li class="nav-item">
                <span class="toggle-subnav invisible btn btn-link fa fa-plus"></span>
                <a href="tutorial-development.html">Development</a>
                <div class="nav-item-sub hidden" id="development_sub"></div>
            </li><li class="nav-item">
                <span class="toggle-subnav invisible btn btn-link fa fa-plus"></span>
                <a href="tutorial-install.html">Building</a>
                <div class="nav-item-sub hidden" id="install_sub"></div>
            </li></ul></div><div class="nav-api hidden"><h3>Modules</h3><ul class="nav-items"><li class="nav-item">
                <span class="toggle-subnav invisible btn btn-link fa fa-plus"></span>
                <a href="module-Gulp.html">Gulp</a>
                <div class="nav-item-sub hidden" id="module_Gulp_sub"></div>
            </li><li class="nav-item">
                <span class="toggle-subnav invisible btn btn-link fa fa-plus"></span>
                <a href="module-ModuleApp.html">ModuleApp</a>
                <div class="nav-item-sub hidden" id="module_ModuleApp_sub"></div>
            </li><li class="nav-item">
                <span class="toggle-subnav invisible btn btn-link fa fa-plus"></span>
                <a href="module-ModuleAvailability.html">ModuleAvailability</a>
                <div class="nav-item-sub hidden" id="module_ModuleAvailability_sub"></div>
            </li><li class="nav-item">
                <span class="toggle-subnav invisible btn btn-link fa fa-plus"></span>
                <a href="module-ModuleCalls.html">ModuleCalls</a>
                <div class="nav-item-sub hidden" id="module_ModuleCalls_sub"></div>
            </li><li class="nav-item">
                <span class="toggle-subnav invisible btn btn-link fa fa-plus"></span>
                <a href="module-ModuleContacts.html">ModuleContacts</a>
                <div class="nav-item-sub hidden" id="module_ModuleContacts_sub"></div>
            </li><li class="nav-item">
                <span class="toggle-subnav invisible btn btn-link fa fa-plus"></span>
                <a href="module-ModuleExtension.html">ModuleExtension</a>
                <div class="nav-item-sub hidden" id="module_ModuleExtension_sub"></div>
            </li><li class="nav-item">
                <span class="toggle-subnav invisible btn btn-link fa fa-plus"></span>
                <a href="module-ModuleQueues.html">ModuleQueues</a>
                <div class="nav-item-sub hidden" id="module_ModuleQueues_sub"></div>
            </li><li class="nav-item">
                <span class="toggle-subnav invisible btn btn-link fa fa-plus"></span>
                <a href="module-ModuleSettings.html">ModuleSettings</a>
                <div class="nav-item-sub hidden" id="module_ModuleSettings_sub"></div>
            </li><li class="nav-item">
                <span class="toggle-subnav invisible btn btn-link fa fa-plus"></span>
                <a href="module-ModuleUI.html">ModuleUI</a>
                <div class="nav-item-sub hidden" id="module_ModuleUI_sub"></div>
            </li><li class="nav-item">
                <span class="toggle-subnav invisible btn btn-link fa fa-plus"></span>
                <a href="module-ModuleUser.html">ModuleUser</a>
                <div class="nav-item-sub hidden" id="module_ModuleUser_sub"></div>
            </li><li class="nav-item">
                <span class="toggle-subnav invisible btn btn-link fa fa-plus"></span>
                <a href="module-Sounds.html">Sounds</a>
                <div class="nav-item-sub hidden" id="module_Sounds_sub"><div class="member-type">Members</div><ul class="inner"><li class="sub-nav-item"><a href="module-Sounds.html#~context">context</a></a></li></ul></div>
            </li><li class="nav-item">
                <span class="toggle-subnav invisible btn btn-link fa fa-plus"></span>
                <a href="module-env.html">env</a>
                <div class="nav-item-sub hidden" id="module_env_sub"><div class="member-type">Methods</div><ul class="inner"><li class="sub-nav-item"><a href="module-env.html#~env">env</a></a></li></ul></div>
            </li></ul></div><div class="nav-api hidden"><h3>Namespaces</h3><ul class="nav-items"><li class="nav-item">
                <span class="toggle-subnav invisible btn btn-link fa fa-plus"></span>
                <a href="AppBackground.html">AppBackground</a>
                <div class="nav-item-sub hidden" id="AppBackground_sub"></div>
            </li><li class="nav-item">
                <span class="toggle-subnav invisible btn btn-link fa fa-plus"></span>
                <a href="AppForeground.html">AppForeground</a>
                <div class="nav-item-sub hidden" id="AppForeground_sub"><div class="member-type">Members</div><ul class="inner"><li class="sub-nav-item"><a href="AppForeground.html#env">env</a></a></li><li class="sub-nav-item"><a href="AppForeground.html#modules">modules</a></a></li><li class="sub-nav-item"><a href="AppForeground.html#sounds">sounds</a></a></li></ul><div class="member-type">Methods</div><ul class="inner"><li class="sub-nav-item"><a href="AppForeground.html#__initStore">__initStore</a></a></li><li class="sub-nav-item"><a href="AppForeground.html#__isObject">__isObject</a></a></li><li class="sub-nav-item"><a href="AppForeground.html#__mergeDeep">__mergeDeep</a></a></li><li class="sub-nav-item"><a href="AppForeground.html#__mergeState">__mergeState</a></a></li><li class="sub-nav-item"><a href="AppForeground.html#__setFromPath">__setFromPath</a></a></li><li class="sub-nav-item"><a href="AppForeground.html#_initialState">_initialState</a></a></li><li class="sub-nav-item"><a href="AppForeground.html#initI18n">initI18n</a></a></li><li class="sub-nav-item"><a href="AppForeground.html#initViewModel">initViewModel</a></a></li><li class="sub-nav-item"><a href="AppForeground.html#setState">setState</a></a></li></ul></div>
            </li><li class="nav-item">
                <span class="toggle-subnav invisible btn btn-link fa fa-plus"></span>
                <a href="AppTab.html">AppTab</a>
                <div class="nav-item-sub hidden" id="AppTab_sub"><div class="member-type">Methods</div><ul class="inner"><li class="sub-nav-item"><a href="AppTab.html#createNumberIconElement">createNumberIconElement</a></a></li><li class="sub-nav-item"><a href="AppTab.html#escapeHTML">escapeHTML</a></a></li><li class="sub-nav-item"><a href="AppTab.html#handleMutations">handleMutations</a></a></li><li class="sub-nav-item"><a href="AppTab.html#insertIconInDom">insertIconInDom</a></a></li><li class="sub-nav-item"><a href="AppTab.html#observePage">observePage</a></a></li><li class="sub-nav-item"><a href="AppTab.html#processPage">processPage</a></a></li><li class="sub-nav-item"><a href="AppTab.html#revertInsertedIcons">revertInsertedIcons</a></a></li></ul></div>
            </li><li class="nav-item">
                <span class="toggle-subnav invisible btn btn-link fa fa-plus"></span>
                <a href="AppForeground.components.html">AppForeground.components</a>
                <div class="nav-item-sub hidden" id="AppForeground_components_sub"></div>
            </li><li class="nav-item">
                <span class="toggle-subnav invisible btn btn-link fa fa-plus"></span>
                <a href="AppBackground.modules.html">AppBackground.modules</a>
                <div class="nav-item-sub hidden" id="AppBackground_modules_sub"></div>
            </li></ul></div><div class="nav-api hidden"><h3>Classes</h3><ul class="nav-items"><li class="nav-item">
                <span class="toggle-subnav invisible btn btn-link fa fa-plus"></span>
                <a href="Api.html">Api</a>
                <div class="nav-item-sub hidden" id="Api_sub"><div class="member-type">Methods</div><ul class="inner"><li class="sub-nav-item"><a href="Api.html#setupClient">setupClient</a></a></li><li class="sub-nav-item"><a href="Api.html#toString">toString</a></a></li></ul></div>
            </li><li class="nav-item">
                <span class="toggle-subnav invisible btn btn-link fa fa-plus"></span>
                <a href="App.html">App</a>
                <div class="nav-item-sub hidden" id="App_sub"><div class="member-type">Members</div><ul class="inner"><li class="sub-nav-item"><a href="App.html#env">env</a></a></li><li class="sub-nav-item"><a href="App.html#modules">modules</a></a></li><li class="sub-nav-item"><a href="App.html#sounds">sounds</a></a></li><li class="sub-nav-item"><a href="App.html#.this.state">this.state</a></a></li></ul><div class="member-type">Methods</div><ul class="inner"><li class="sub-nav-item"><a href="App.html#__initStore">__initStore</a></a></li><li class="sub-nav-item"><a href="App.html#__isObject">__isObject</a></a></li><li class="sub-nav-item"><a href="App.html#__mergeDeep">__mergeDeep</a></a></li><li class="sub-nav-item"><a href="App.html#__mergeState">__mergeState</a></a></li><li class="sub-nav-item"><a href="App.html#__setFromPath">__setFromPath</a></a></li><li class="sub-nav-item"><a href="App.html#_initialState">_initialState</a></a></li><li class="sub-nav-item"><a href="App.html#.helpers">helpers</a></a></li><li class="sub-nav-item"><a href="App.html#initI18n">initI18n</a></a></li><li class="sub-nav-item"><a href="App.html#initViewModel">initViewModel</a></a></li><li class="sub-nav-item"><a href="App.html#setState">setState</a></a></li></ul></div>
            </li><li class="nav-item">
                <span class="toggle-subnav invisible btn btn-link fa fa-plus"></span>
                <a href="app.AppBackground.html">AppBackground</a>
                <div class="nav-item-sub hidden" id="app_AppBackground_sub"><div class="member-type">Members</div><ul class="inner"><li class="sub-nav-item"><a href="app.AppBackground.html#store">store</a></a></li></ul><div class="member-type">Methods</div><ul class="inner"><li class="sub-nav-item"><a href="app.AppBackground.html#__factoryDefaults">__factoryDefaults</a></a></li><li class="sub-nav-item"><a href="app.AppBackground.html#__initServices">__initServices</a></a></li><li class="sub-nav-item"><a href="app.AppBackground.html#__initStore">__initStore</a></a></li><li class="sub-nav-item"><a href="app.AppBackground.html#__logoutState">__logoutState</a></a></li><li class="sub-nav-item"><a href="app.AppBackground.html#__mergeState">__mergeState</a></a></li><li class="sub-nav-item"><a href="app.AppBackground.html#__unlockVault">__unlockVault</a></a></li><li class="sub-nav-item"><a href="app.AppBackground.html#_platformData">_platformData</a></a></li><li class="sub-nav-item"><a href="app.AppBackground.html#_restoreState">_restoreState</a></a></li></ul></div>
            </li><li class="nav-item">
                <span class="toggle-subnav invisible btn btn-link fa fa-plus"></span>
                <a href="AppElectron.html">AppElectron</a>
                <div class="nav-item-sub hidden" id="AppElectron_sub"></div>
            </li><li class="nav-item">
                <span class="toggle-subnav invisible btn btn-link fa fa-plus"></span>
                <a href="AppForeground.html">AppForeground</a>
                <div class="nav-item-sub hidden" id="AppForeground_sub"><div class="member-type">Members</div><ul class="inner"><li class="sub-nav-item"><a href="AppForeground.html#env">env</a></a></li><li class="sub-nav-item"><a href="AppForeground.html#modules">modules</a></a></li><li class="sub-nav-item"><a href="AppForeground.html#sounds">sounds</a></a></li></ul><div class="member-type">Methods</div><ul class="inner"><li class="sub-nav-item"><a href="AppForeground.html#__initStore">__initStore</a></a></li><li class="sub-nav-item"><a href="AppForeground.html#__isObject">__isObject</a></a></li><li class="sub-nav-item"><a href="AppForeground.html#__mergeDeep">__mergeDeep</a></a></li><li class="sub-nav-item"><a href="AppForeground.html#__mergeState">__mergeState</a></a></li><li class="sub-nav-item"><a href="AppForeground.html#__setFromPath">__setFromPath</a></a></li><li class="sub-nav-item"><a href="AppForeground.html#_initialState">_initialState</a></a></li><li class="sub-nav-item"><a href="AppForeground.html#initI18n">initI18n</a></a></li><li class="sub-nav-item"><a href="AppForeground.html#initViewModel">initViewModel</a></a></li><li class="sub-nav-item"><a href="AppForeground.html#setState">setState</a></a></li></ul></div>
            </li><li class="nav-item">
                <span class="toggle-subnav invisible btn btn-link fa fa-plus"></span>
                <a href="AppTab.html">AppTab</a>
                <div class="nav-item-sub hidden" id="AppTab_sub"><div class="member-type">Methods</div><ul class="inner"><li class="sub-nav-item"><a href="AppTab.html#createNumberIconElement">createNumberIconElement</a></a></li><li class="sub-nav-item"><a href="AppTab.html#escapeHTML">escapeHTML</a></a></li><li class="sub-nav-item"><a href="AppTab.html#handleMutations">handleMutations</a></a></li><li class="sub-nav-item"><a href="AppTab.html#insertIconInDom">insertIconInDom</a></a></li><li class="sub-nav-item"><a href="AppTab.html#observePage">observePage</a></a></li><li class="sub-nav-item"><a href="AppTab.html#processPage">processPage</a></a></li><li class="sub-nav-item"><a href="AppTab.html#revertInsertedIcons">revertInsertedIcons</a></a></li></ul></div>
            </li><li class="nav-item">
                <span class="toggle-subnav invisible btn btn-link fa fa-plus"></span>
                <a href="module-Sounds-BusyTone.html">BusyTone</a>
                <div class="nav-item-sub hidden" id="module_Sounds_BusyTone_sub"></div>
            </li><li class="nav-item">
                <span class="toggle-subnav invisible btn btn-link fa fa-plus"></span>
                <a href="module-ModuleCalls-Call.html">Call</a>
                <div class="nav-item-sub hidden" id="module_ModuleCalls_Call_sub"><div class="member-type">Members</div><ul class="inner"><li class="sub-nav-item"><a href="module-ModuleCalls-Call.html#state">state</a></a></li></ul><div class="member-type">Methods</div><ul class="inner"><li class="sub-nav-item"><a href="module-ModuleCalls-Call.html#_incoming">_incoming</a></a></li><li class="sub-nav-item"><a href="module-ModuleCalls-Call.html#_initMedia">_initMedia</a></a></li><li class="sub-nav-item"><a href="module-ModuleCalls-Call.html#_outgoing">_outgoing</a></a></li><li class="sub-nav-item"><a href="module-ModuleCalls-Call.html#_start">_start</a></a></li><li class="sub-nav-item"><a href="module-ModuleCalls-Call.html#_stop">_stop</a></a></li><li class="sub-nav-item"><a href="module-ModuleCalls-Call.html#generateUUID">generateUUID</a></a></li><li class="sub-nav-item"><a href="module-ModuleCalls-Call.html#setState">setState</a></a></li><li class="sub-nav-item"><a href="module-ModuleCalls-Call.html#toString">toString</a></a></li></ul></div>
            </li><li class="nav-item">
                <span class="toggle-subnav invisible btn btn-link fa fa-plus"></span>
                <a href="module-ModuleCalls-CallConnectAB.html">CallConnectAB</a>
                <div class="nav-item-sub hidden" id="module_ModuleCalls_CallConnectAB_sub"><div class="member-type">Methods</div><ul class="inner"><li class="sub-nav-item"><a href="module-ModuleCalls-CallConnectAB.html#_callStatus">_callStatus</a></a></li><li class="sub-nav-item"><a href="module-ModuleCalls-CallConnectAB.html#hold">hold</a></a></li><li class="sub-nav-item"><a href="module-ModuleCalls-CallConnectAB.html#unhold">unhold</a></a></li></ul></div>
            </li><li class="nav-item">
                <span class="toggle-subnav invisible btn btn-link fa fa-plus"></span>
                <a href="module-ModuleCalls-CallSIP.html">CallSIP</a>
                <div class="nav-item-sub hidden" id="module_ModuleCalls_CallSIP_sub"><div class="member-type">Methods</div><ul class="inner"><li class="sub-nav-item"><a href="module-ModuleCalls-CallSIP.html#_incoming">_incoming</a></a></li><li class="sub-nav-item"><a href="module-ModuleCalls-CallSIP.html#_outgoing">_outgoing</a></a></li><li class="sub-nav-item"><a href="module-ModuleCalls-CallSIP.html#accept">accept</a></a></li><li class="sub-nav-item"><a href="module-ModuleCalls-CallSIP.html#terminate">terminate</a></a></li></ul></div>
            </li><li class="nav-item">
                <span class="toggle-subnav invisible btn btn-link fa fa-plus"></span>
                <a href="module-ModuleContacts-Contact.html">Contact</a>
                <div class="nav-item-sub hidden" id="module_ModuleContacts_Contact_sub"><div class="member-type">Methods</div><ul class="inner"><li class="sub-nav-item"><a href="module-ModuleContacts-Contact.html#setState">setState</a></a></li></ul></div>
            </li><li class="nav-item">
                <span class="toggle-subnav invisible btn btn-link fa fa-plus"></span>
                <a href="module-ModuleContacts-ContactSip.html">ContactSip</a>
                <div class="nav-item-sub hidden" id="module_ModuleContacts_ContactSip_sub"></div>
            </li><li class="nav-item">
                <span class="toggle-subnav invisible btn btn-link fa fa-plus"></span>
                <a href="Crypto.html">Crypto</a>
                <div class="nav-item-sub hidden" id="Crypto_sub"><div class="member-type">Methods</div><ul class="inner"><li class="sub-nav-item"><a href="Crypto.html#__base64ToDataArray">__base64ToDataArray</a></a></li><li class="sub-nav-item"><a href="Crypto.html#__dataArray">__dataArray</a></a></li><li class="sub-nav-item"><a href="Crypto.html#__dataArrayToBase64">__dataArrayToBase64</a></a></li><li class="sub-nav-item"><a href="Crypto.html#__dataArrayToHex">__dataArrayToHex</a></a></li><li class="sub-nav-item"><a href="Crypto.html#__dataArrayToString">__dataArrayToString</a></a></li><li class="sub-nav-item"><a href="Crypto.html#__deriveAESKeyFromECDH">__deriveAESKeyFromECDH</a></a></li><li class="sub-nav-item"><a href="Crypto.html#__exportAESKey">__exportAESKey</a></a></li><li class="sub-nav-item"><a href="Crypto.html#__exportPrivateKey">__exportPrivateKey</a></a></li><li class="sub-nav-item"><a href="Crypto.html#__exportPublicKey">__exportPublicKey</a></a></li><li class="sub-nav-item"><a href="Crypto.html#__hashString">__hashString</a></a></li><li class="sub-nav-item"><a href="Crypto.html#__importPrivateKey">__importPrivateKey</a></a></li><li class="sub-nav-item"><a href="Crypto.html#__importPublicKey">__importPublicKey</a></a></li><li class="sub-nav-item"><a href="Crypto.html#__stringToDataArray">__stringToDataArray</a></a></li><li class="sub-nav-item"><a href="Crypto.html#_generateVaultKey">_generateVaultKey</a></a></li><li class="sub-nav-item"><a href="Crypto.html#_importVaultKey">_importVaultKey</a></a></li><li class="sub-nav-item"><a href="Crypto.html#decrypt">decrypt</a></a></li><li class="sub-nav-item"><a href="Crypto.html#encrypt">encrypt</a></a></li><li class="sub-nav-item"><a href="Crypto.html#loadIdentity">loadIdentity</a></a></li><li class="sub-nav-item"><a href="Crypto.html#storeVault">storeVault</a></a></li><li class="sub-nav-item"><a href="Crypto.html#toString">toString</a></a></li></ul></div>
            </li><li class="nav-item">
                <span class="toggle-subnav invisible btn btn-link fa fa-plus"></span>
                <a href="module-Sounds-DtmfTone.html">DtmfTone</a>
                <div class="nav-item-sub hidden" id="module_Sounds_DtmfTone_sub"></div>
            </li><li class="nav-item">
                <span class="toggle-subnav invisible btn btn-link fa fa-plus"></span>
                <a href="Gulp.Helpers.html">Helpers</a>
                <div class="nav-item-sub hidden" id="Gulp_Helpers_sub"><div class="member-type">Methods</div><ul class="inner"><li class="sub-nav-item"><a href="Gulp.Helpers.html#deploy">deploy</a></a></li><li class="sub-nav-item"><a href="Gulp.Helpers.html#distributionName">distributionName</a></a></li><li class="sub-nav-item"><a href="Gulp.Helpers.html#formatScssVars">formatScssVars</a></a></li><li class="sub-nav-item"><a href="Gulp.Helpers.html#getManifest">getManifest</a></a></li><li class="sub-nav-item"><a href="Gulp.Helpers.html#jsEntry">jsEntry</a></a></li><li class="sub-nav-item"><a href="Gulp.Helpers.html#scssEntry">scssEntry</a></a></li><li class="sub-nav-item"><a href="Gulp.Helpers.html#startDevServer">startDevServer</a></a></li></ul></div>
            </li><li class="nav-item">
                <span class="toggle-subnav invisible btn btn-link fa fa-plus"></span>
                <a href="lib.Logger.html">Logger</a>
                <div class="nav-item-sub hidden" id="lib_Logger_sub"></div>
            </li><li class="nav-item">
                <span class="toggle-subnav invisible btn btn-link fa fa-plus"></span>
                <a href="MemoryStore.html">MemoryStore</a>
                <div class="nav-item-sub hidden" id="MemoryStore_sub"></div>
            </li><li class="nav-item">
                <span class="toggle-subnav invisible btn btn-link fa fa-plus"></span>
                <a href="Module.html">Module</a>
                <div class="nav-item-sub hidden" id="Module_sub"></div>
            </li><li class="nav-item">
                <span class="toggle-subnav invisible btn btn-link fa fa-plus"></span>
                <a href="AppBackground.modules.ModuleApp.html">ModuleApp</a>
                <div class="nav-item-sub hidden" id="AppBackground_modules_ModuleApp_sub"><div class="member-type">Methods</div><ul class="inner"><li class="sub-nav-item"><a href="AppBackground.modules.ModuleApp.html#_initialState">_initialState</a></a></li><li class="sub-nav-item"><a href="AppBackground.modules.ModuleApp.html#_restoreState">_restoreState</a></a></li></ul></div>
            </li><li class="nav-item">
                <span class="toggle-subnav invisible btn btn-link fa fa-plus"></span>
                <a href="AppBackground.modules.ModuleAvailability.html">ModuleAvailability</a>
                <div class="nav-item-sub hidden" id="AppBackground_modules_ModuleAvailability_sub"><div class="member-type">Methods</div><ul class="inner"><li class="sub-nav-item"><a href="AppBackground.modules.ModuleAvailability.html#_initialState">_initialState</a></a></li><li class="sub-nav-item"><a href="AppBackground.modules.ModuleAvailability.html#_platformData">_platformData</a></a></li><li class="sub-nav-item"><a href="AppBackground.modules.ModuleAvailability.html#_watchers">_watchers</a></a></li><li class="sub-nav-item"><a href="AppBackground.modules.ModuleAvailability.html#toString">toString</a></a></li></ul></div>
            </li><li class="nav-item">
                <span class="toggle-subnav invisible btn btn-link fa fa-plus"></span>
                <a href="AppBackground.modules.ModuleCalls.html">ModuleCalls</a>
                <div class="nav-item-sub hidden" id="AppBackground_modules_ModuleCalls_sub"><div class="member-type">Methods</div><ul class="inner"><li class="sub-nav-item"><a href="AppBackground.modules.ModuleCalls.html#__setTransferState">__setTransferState</a></a></li><li class="sub-nav-item"><a href="AppBackground.modules.ModuleCalls.html#__uaOptions">__uaOptions</a></a></li><li class="sub-nav-item"><a href="AppBackground.modules.ModuleCalls.html#_emptyCall">_emptyCall</a></a></li><li class="sub-nav-item"><a href="AppBackground.modules.ModuleCalls.html#_formatSdp">_formatSdp</a></a></li><li class="sub-nav-item"><a href="AppBackground.modules.ModuleCalls.html#_initialState">_initialState</a></a></li><li class="sub-nav-item"><a href="AppBackground.modules.ModuleCalls.html#_restoreState">_restoreState</a></a></li><li class="sub-nav-item"><a href="AppBackground.modules.ModuleCalls.html#_userAgent">_userAgent</a></a></li><li class="sub-nav-item"><a href="AppBackground.modules.ModuleCalls.html#activateCall">activateCall</a></a></li><li class="sub-nav-item"><a href="AppBackground.modules.ModuleCalls.html#activeCall">activeCall</a></a></li><li class="sub-nav-item"><a href="AppBackground.modules.ModuleCalls.html#callAction">callAction</a></a></li><li class="sub-nav-item"><a href="AppBackground.modules.ModuleCalls.html#connect">connect</a></a></li><li class="sub-nav-item"><a href="AppBackground.modules.ModuleCalls.html#deleteCall">deleteCall</a></a></li><li class="sub-nav-item"><a href="AppBackground.modules.ModuleCalls.html#disconnect">disconnect</a></a></li><li class="sub-nav-item"><a href="AppBackground.modules.ModuleCalls.html#toString">toString</a></a></li></ul></div>
            </li><li class="nav-item">
                <span class="toggle-subnav invisible btn btn-link fa fa-plus"></span>
                <a href="AppBackground.modules.ModuleContacts.html">ModuleContacts</a>
                <div class="nav-item-sub hidden" id="AppBackground_modules_ModuleContacts_sub"><div class="member-type">Methods</div><ul class="inner"><li class="sub-nav-item"><a href="AppBackground.modules.ModuleContacts.html#_initialState">_initialState</a></a></li><li class="sub-nav-item"><a href="AppBackground.modules.ModuleContacts.html#_platformData">_platformData</a></a></li><li class="sub-nav-item"><a href="AppBackground.modules.ModuleContacts.html#_restoreState">_restoreState</a></a></li><li class="sub-nav-item"><a href="AppBackground.modules.ModuleContacts.html#toString">toString</a></a></li></ul></div>
            </li><li class="nav-item">
                <span class="toggle-subnav invisible btn btn-link fa fa-plus"></span>
                <a href="AppBackground.modules.ModuleExtension.html">ModuleExtension</a>
                <div class="nav-item-sub hidden" id="AppBackground_modules_ModuleExtension_sub"><div class="member-type">Methods</div><ul class="inner"><li class="sub-nav-item"><a href="AppBackground.modules.ModuleExtension.html#_installUpdate">_installUpdate</a></a></li><li class="sub-nav-item"><a href="AppBackground.modules.ModuleExtension.html#_keyboardShortcuts">_keyboardShortcuts</a></a></li><li class="sub-nav-item"><a href="AppBackground.modules.ModuleExtension.html#_ready">_ready</a></a></li></ul></div>
            </li><li class="nav-item">
                <span class="toggle-subnav invisible btn btn-link fa fa-plus"></span>
                <a href="AppBackground.modules.ModuleQueues.html">ModuleQueues</a>
                <div class="nav-item-sub hidden" id="AppBackground_modules_ModuleQueues_sub"><div class="member-type">Methods</div><ul class="inner"><li class="sub-nav-item"><a href="AppBackground.modules.ModuleQueues.html#_initialState">_initialState</a></a></li><li class="sub-nav-item"><a href="AppBackground.modules.ModuleQueues.html#_onPopupAction">_onPopupAction</a></a></li><li class="sub-nav-item"><a href="AppBackground.modules.ModuleQueues.html#_platformData">_platformData</a></a></li><li class="sub-nav-item"><a href="AppBackground.modules.ModuleQueues.html#queueMenubarIcon">queueMenubarIcon</a></a></li><li class="sub-nav-item"><a href="AppBackground.modules.ModuleQueues.html#setQueueSizesTimer">setQueueSizesTimer</a></a></li><li class="sub-nav-item"><a href="AppBackground.modules.ModuleQueues.html#toString">toString</a></a></li></ul></div>
            </li><li class="nav-item">
                <span class="toggle-subnav invisible btn btn-link fa fa-plus"></span>
                <a href="AppBackground.modules.ModuleSettings.html">ModuleSettings</a>
                <div class="nav-item-sub hidden" id="AppBackground_modules_ModuleSettings_sub"><div class="member-type">Methods</div><ul class="inner"><li class="sub-nav-item"><a href="AppBackground.modules.ModuleSettings.html#_initialState">_initialState</a></a></li><li class="sub-nav-item"><a href="AppBackground.modules.ModuleSettings.html#_watchers">_watchers</a></a></li></ul></div>
            </li><li class="nav-item">
                <span class="toggle-subnav invisible btn btn-link fa fa-plus"></span>
                <a href="AppBackground.modules.ModuleUI.html">ModuleUI</a>
                <div class="nav-item-sub hidden" id="AppBackground_modules_ModuleUI_sub"><div class="member-type">Methods</div><ul class="inner"><li class="sub-nav-item"><a href="AppBackground.modules.ModuleUI.html#__menubarAnimation">__menubarAnimation</a></a></li><li class="sub-nav-item"><a href="AppBackground.modules.ModuleUI.html#_initialState">_initialState</a></a></li><li class="sub-nav-item"><a href="AppBackground.modules.ModuleUI.html#_restoreState">_restoreState</a></a></li><li class="sub-nav-item"><a href="AppBackground.modules.ModuleUI.html#_watchers">_watchers</a></a></li><li class="sub-nav-item"><a href="AppBackground.modules.ModuleUI.html#notification">notification</a></a></li></ul></div>
            </li><li class="nav-item">
                <span class="toggle-subnav invisible btn btn-link fa fa-plus"></span>
                <a href="AppBackground.modules.ModuleUser.html">ModuleUser</a>
                <div class="nav-item-sub hidden" id="AppBackground_modules_ModuleUser_sub"><div class="member-type">Methods</div><ul class="inner"><li class="sub-nav-item"><a href="AppBackground.modules.ModuleUser.html#_initialState">_initialState</a></a></li><li class="sub-nav-item"><a href="AppBackground.modules.ModuleUser.html#_platformData">_platformData</a></a></li><li class="sub-nav-item"><a href="AppBackground.modules.ModuleUser.html#login">login</a></a></li><li class="sub-nav-item"><a href="AppBackground.modules.ModuleUser.html#logout">logout</a></a></li><li class="sub-nav-item"><a href="AppBackground.modules.ModuleUser.html#toString">toString</a></a></li></ul></div>
            </li><li class="nav-item">
                <span class="toggle-subnav invisible btn btn-link fa fa-plus"></span>
                <a href="module-ModuleContacts-Presence.html">Presence</a>
                <div class="nav-item-sub hidden" id="module_ModuleContacts_Presence_sub"></div>
            </li><li class="nav-item">
                <span class="toggle-subnav invisible btn btn-link fa fa-plus"></span>
                <a href="module-ModuleContacts-PresenceSip.html">PresenceSip</a>
                <div class="nav-item-sub hidden" id="module_ModuleContacts_PresenceSip_sub"><div class="member-type">Methods</div><ul class="inner"><li class="sub-nav-item"><a href="module-ModuleContacts-PresenceSip.html#_statusFromDialog">_statusFromDialog</a></a></li><li class="sub-nav-item"><a href="module-ModuleContacts-PresenceSip.html#subscribe">subscribe</a></a></li><li class="sub-nav-item"><a href="module-ModuleContacts-PresenceSip.html#unsubscribe">unsubscribe</a></a></li></ul></div>
            </li><li class="nav-item">
                <span class="toggle-subnav invisible btn btn-link fa fa-plus"></span>
                <a href="module-Sounds-RingTone.html">RingTone</a>
                <div class="nav-item-sub hidden" id="module_Sounds_RingTone_sub"></div>
            </li><li class="nav-item">
                <span class="toggle-subnav invisible btn btn-link fa fa-plus"></span>
                <a href="module-Sounds-RingbackTone.html">RingbackTone</a>
                <div class="nav-item-sub hidden" id="module_Sounds_RingbackTone_sub"></div>
            </li><li class="nav-item">
                <span class="toggle-subnav invisible btn btn-link fa fa-plus"></span>
                <a href="app.Skeleton.html">Skeleton</a>
                <div class="nav-item-sub hidden" id="app_Skeleton_sub"><div class="member-type">Methods</div><ul class="inner"><li class="sub-nav-item"><a href="app.Skeleton.html#emit">emit</a></a></li><li class="sub-nav-item"><a href="app.Skeleton.html#ipcListener">ipcListener</a></a></li><li class="sub-nav-item"><a href="app.Skeleton.html#on">on</a></a></li><li class="sub-nav-item"><a href="app.Skeleton.html#toString">toString</a></a></li></ul></div>
            </li><li class="nav-item">
                <span class="toggle-subnav invisible btn btn-link fa fa-plus"></span>
                <a href="Sounds.SoundMeter.html">SoundMeter</a>
                <div class="nav-item-sub hidden" id="Sounds_SoundMeter_sub"></div>
            </li><li class="nav-item">
                <span class="toggle-subnav invisible btn btn-link fa fa-plus"></span>
                <a href="Store.html">Store</a>
                <div class="nav-item-sub hidden" id="Store_sub"><div class="member-type">Methods</div><ul class="inner"><li class="sub-nav-item"><a href="Store.html#clear">clear</a></a></li><li class="sub-nav-item"><a href="Store.html#toString">toString</a></a></li></ul></div>
            </li><li class="nav-item">
                <span class="toggle-subnav invisible btn btn-link fa fa-plus"></span>
                <a href="app.modules.extension.Tabs.html">Tabs</a>
                <div class="nav-item-sub hidden" id="app_modules_extension_Tabs_sub"><div class="member-type">Methods</div><ul class="inner"><li class="sub-nav-item"><a href="app.modules.extension.Tabs.html#contextMenuItems">contextMenuItems</a></a></li><li class="sub-nav-item"><a href="app.modules.extension.Tabs.html#signalIcons">signalIcons</a></a></li></ul></div>
            </li><li class="nav-item">
                <span class="toggle-subnav invisible btn btn-link fa fa-plus"></span>
                <a href="Telemetry.html">Telemetry</a>
                <div class="nav-item-sub hidden" id="Telemetry_sub"><div class="member-type">Methods</div><ul class="inner"><li class="sub-nav-item"><a href="Telemetry.html#event">event</a></a></li><li class="sub-nav-item"><a href="Telemetry.html#getClientId">getClientId</a></a></li><li class="sub-nav-item"><a href="Telemetry.html#toString">toString</a></a></li></ul></div>
            </li><li class="nav-item">
                <span class="toggle-subnav invisible btn btn-link fa fa-plus"></span>
                <a href="Timer.html">Timer</a>
                <div class="nav-item-sub hidden" id="Timer_sub"><div class="member-type">Methods</div><ul class="inner"><li class="sub-nav-item"><a href="Timer.html#__jitter">__jitter</a></a></li><li class="sub-nav-item"><a href="Timer.html#increaseTimeout">increaseTimeout</a></a></li><li class="sub-nav-item"><a href="Timer.html#setTimeout">setTimeout</a></a></li><li class="sub-nav-item"><a href="Timer.html#toString">toString</a></a></li></ul></div>
            </li><li class="nav-item">
                <span class="toggle-subnav invisible btn btn-link fa fa-plus"></span>
                <a href="App.Utils.html">Utils</a>
                <div class="nav-item-sub hidden" id="App_Utils_sub"><div class="member-type">Methods</div><ul class="inner"><li class="sub-nav-item"><a href="App.Utils.html#sanitizeNumber">sanitizeNumber</a></a></li><li class="sub-nav-item"><a href="App.Utils.html#stringifySearch">stringifySearch</a></a></li></ul></div>
            </li><li class="nav-item">
                <span class="toggle-subnav invisible btn btn-link fa fa-plus"></span>
                <a href="tab.Walker.html">Walker</a>
                <div class="nav-item-sub hidden" id="tab_Walker_sub"><div class="member-type">Methods</div><ul class="inner"><li class="sub-nav-item"><a href="tab.Walker.html#getBlockedRoles">getBlockedRoles</a></a></li><li class="sub-nav-item"><a href="tab.Walker.html#getBlockedTagNames">getBlockedTagNames</a></a></li><li class="sub-nav-item"><a href="tab.Walker.html#isBlockedElement">isBlockedElement</a></a></li><li class="sub-nav-item"><a href="tab.Walker.html#skipNode">skipNode</a></a></li><li class="sub-nav-item"><a href="tab.Walker.html#walkTheDOM">walkTheDOM</a></a></li></ul></div>
            </li></ul></div>
        </div>
    </nav>

    <div class="content">
        <ul class="breadcrumbs">
            <li><a href="index.html">Docs</a> »</li>
            <li>Source: gulpfile.js</li>
        </ul>
        <hr>
        



    
<article>
    <pre class="prettyprint source linenums"><code>/**
* Gulp buildsystem. Takes care of tasks like bundling JavaScript,
* deploying to stores, transpiling SCSS, minifying, concatting,
* copying assets around, and more.
* @module Gulp
*/
const {_extend, promisify} = require('util')
const archiver = require('archiver')
const fs = require('fs')
const path = require('path')
const addsrc = require('gulp-add-src')
const argv = require('yargs').argv
const childExec = require('child_process').exec
const colorize = require('tap-colorize')
const composer = require('gulp-uglify/composer')
const concat = require('gulp-concat')
const del = require('del')
const flatten = require('gulp-flatten')
const fuet = require('gulp-fuet')
const ghPages = require('gulp-gh-pages')
const gulp = require('gulp-help')(require('gulp'), {})
const gutil = require('gulp-util')
const Helpers = require('./tasks/helpers')
const livereload = require('gulp-livereload')
const ifElse = require('gulp-if-else')
const insert = require('gulp-insert')
const imagemin = require('gulp-imagemin')
const minifier = composer(require('uglify-es'), console)
const mkdirp = promisify(require('mkdirp'))
const notify = require('gulp-notify')
const replace = require('gulp-replace')
const rc = require('rc')
const runSequence = require('run-sequence')
const size = require('gulp-size')
const svgo = require('gulp-svgo')
const tape = require('gulp-tape')
const test = require('tape')

const writeFileAsync = promisify(fs.writeFile)

// The main settings object containing info
// from .vialer-jsrc and build flags.
let settings = {}

settings.BUILD_ARCH = argv.arch ? argv.arch : 'x64' // all, or one or more of: ia32, x64, armv7l, arm64, mips64el
settings.BUILD_DIR = process.env.BUILD_DIR || path.join('./', 'build')
settings.BUILD_PLATFORM = argv.platform ? argv.platform : 'linux' // all, or one or more of: darwin, linux, mas, win32
settings.BRAND_TARGET = argv.brand ? argv.brand : 'vialer'
settings.BUILD_TARGET = argv.target ? argv.target : 'chrome'
settings.BUILD_TARGETS = ['chrome', 'electron', 'edge', 'firefox', 'node', 'webview']

// Exit when the build target is not in the allowed list.
if (!settings.BUILD_TARGETS.includes(settings.BUILD_TARGET)) {
    gutil.log(`Invalid build target: ${settings.BUILD_TARGET}`)
    process.exit(0)
}

// Default deploy target is `alpha` because it has the least impact.
settings.DEPLOY_TARGET = argv.deploy ? argv.deploy : 'alpha'
// Exit when the deploy target is not in the allowed list.
if (!['alpha', 'beta', 'production'].includes(settings.DEPLOY_TARGET)) {
    gutil.log(`Invalid deployment target: '${settings.DEPLOY_TARGET}'`)
    process.exit(0)
}
settings.LIVERELOAD = false
settings.NODE_PATH = path.join(__dirname, 'node_modules') || process.env.NODE_PATH
settings.PACKAGE = require('./package')
settings.SRC_DIR = path.join('./', 'src')
settings.SIZE_OPTIONS = {showFiles: true, showTotal: true}
settings.TEMP_DIR = path.join(settings.BUILD_DIR, '__tmp')
settings.VERBOSE = argv.verbose ? true : false

// Force production mode when running certain tasks from
// the commandline or when using a deploy command.
if (argv._[0] &amp;&amp; (['deploy', 'build-dist'].includes(argv._[0]) || argv._[0].includes('deploy'))) {
    settings.PRODUCTION = true
    // Force NODE_ENV to production for envify.
    process.env.NODE_ENV = 'production'
} else {
    // Production mode is on when NODE_ENV environmental var is set.
    settings.PRODUCTION = argv.production ? argv.production : (process.env.NODE_ENV === 'production')

    if (!process.env.NODE_ENV) process.env.NODE_ENV = 'development'
}

settings.NODE_ENV = process.env.NODE_ENV

// Loads the Vialer settings from ~/.vialer-jsrc into the
// existing settings object.
rc('vialer-js', settings)


// Simple brand validation checks.
if (!settings.brands[settings.BRAND_TARGET]) {
    gutil.log(`(!) Brand ${settings.BRAND_TARGET} does not exist. Check vialer-jsrc.`)
    process.exit(0)
}
for (let brand in settings.brands) {
    try {
        fs.statSync(`./src/brand/${brand}`)
    } catch (err) {
        gutil.log(`(!) Brand directory is missing for brand "${brand}"`)
        process.exit(0)
    }
}
// Initialize the helpers, which make this file less dense.
const helpers = new Helpers(settings)


const WATCHLINKED = argv.linked ? argv.linked : false
const WITHDOCS = argv.docs ? argv.docs : false

let taskOptions = {}
if (settings.VERBOSE) {
    taskOptions = {
        all: {
            'brand=vialer': '',
            'target=chrome': 'chrome|electron|firefox|node|webview',
        },
        brandOnly: {
            'brand=vialer': '',
        },
        browser: {
            'brand=vialer': '',
            'target=chrome': 'chrome|firefox',
        },
        targetOnly: {
            'target=chrome': 'chrome|electron|firefox|node|webview',
        },
        webview: {
            'brand=vialer': '',
            'target=chrome': 'electron|webview',
        },
    }
}

// Notify developer about some essential build flag values.
gutil.log('BUILD FLAGS:')
gutil.log(`- BRAND: ${settings.BRAND_TARGET}`)
gutil.log(`- DEPLOY: ${settings.DEPLOY_TARGET}`)
gutil.log(`- PRODUCTION: ${settings.PRODUCTION}`)
gutil.log(`- TARGET: ${settings.BUILD_TARGET}`)
gutil.log(`- VERBOSE: ${settings.VERBOSE}`)


gulp.task('assets', 'Copy (branded) assets to the build directory.', () => {
    const robotoPath = path.join(settings.NODE_PATH, 'roboto-fontface', 'fonts', 'roboto')
    return gulp.src(path.join(robotoPath, '{Roboto-Light.woff2,Roboto-Regular.woff2,Roboto-Medium.woff2}'))
        .pipe(flatten({newPath: './fonts'}))
        .pipe(addsrc(`./src/brand/${settings.BRAND_TARGET}/img/{*.icns,*.png,*.jpg,*.gif}`, {base: `./src/brand/${settings.BRAND_TARGET}/`}))
        .pipe(addsrc(`./src/brand/${settings.BRAND_TARGET}/ringtones/*`, {base: `./src/brand/${settings.BRAND_TARGET}/`}))
        .pipe(ifElse(settings.PRODUCTION, imagemin))
        .pipe(ifElse(settings.BUILD_TARGET === 'electron', () => addsrc('./package.json')))
        .pipe(addsrc('./LICENSE'))
        .pipe(addsrc('./README.md'))
        .pipe(addsrc('./src/_locales/**', {base: './src/'}))
        .pipe(gulp.dest(`./build/${settings.BRAND_TARGET}/${settings.BUILD_TARGET}`))
        .pipe(size(_extend({title: 'assets'}, settings.SIZE_OPTIONS)))
        .pipe(ifElse(settings.LIVERELOAD, livereload))
}, {options: taskOptions.all})


gulp.task('build', 'Make a branded unoptimized development build.', (done) => {
    // Refresh the brand content with each build.
    let targetTasks
    if (settings.BUILD_TARGET === 'electron') targetTasks = ['js-electron']
    else if (settings.BUILD_TARGET === 'webview') targetTasks = ['js-vendor', 'js-app-bg', 'js-app-fg']
    else if (['chrome', 'firefox'].includes(settings.BUILD_TARGET)) targetTasks = ['js-vendor', 'js-app-bg', 'js-app-fg', 'js-app-observer', 'manifest']

    runSequence(['assets', 'templates', 'translations', 'html', 'scss', 'scss-vendor'].concat(targetTasks), done)
}, {options: taskOptions.all})


gulp.task('build-targets', 'Build all targets.', (done) => {
    // Refresh the brand content with each build.
    let electronTargetTasks = ['assets', 'html', 'scss', 'js-electron-main', 'js-vendor']
    let pluginTargetTasks = ['assets', 'html', 'scss', 'js-vendor', 'js-app-bg', 'js-app-fg', 'manifest']
    settings.BUILD_TARGET = 'chrome'
    runSequence(pluginTargetTasks, () => {
        settings.BUILD_TARGET = 'firefox'
        runSequence(pluginTargetTasks, () => {
            settings.BUILD_TARGET = 'edge'
            runSequence(pluginTargetTasks, () => {
                settings.BUILD_TARGET = 'electron'
                runSequence(electronTargetTasks, () => {
                    done()
                })
            })
        })
    })
})


gulp.task('build-clean', 'Clear the build directory', async() => {
    await del([path.join(settings.BUILD_DIR, settings.BRAND_TARGET, settings.BUILD_TARGET, '**')], {force: true})
    await mkdirp(path.join(settings.BUILD_DIR, settings.BRAND_TARGET, settings.BUILD_TARGET))
}, {options: taskOptions.all})


gulp.task('build-dist', 'Make an optimized build suitable for distribution.', ['build'], (done) => {
    const buildDir = path.join(__dirname, 'build', settings.BRAND_TARGET, settings.BUILD_TARGET)
    const distDir = path.join(__dirname, 'dist', settings.BRAND_TARGET)
    mkdirp(distDir).then(() => {
        let distName = helpers.distributionName(settings.BRAND_TARGET)

        // Not using Gulp's Vinyl-based zip, because of a symlink issue that prevents
        // the MacOS build to be zipped properly. See https://github.com/gulpjs/gulp/issues/1427
        const output = fs.createWriteStream(path.join(distDir, distName))
        const archive = archiver('zip', {zlib: {level: 6}})

        output.on('close', function() {
            gutil.log(archive.pointer() + ' total bytes archived')
            done()
        })

        archive.pipe(output)

        if (['chrome', 'firefox'].includes(settings.BUILD_TARGET)) {
            archive.directory(buildDir, false)
            archive.finalize()
        } else if (settings.BUILD_TARGET === 'electron') {
            const iconParam = `--icon=${buildDir}/img/electron-icon.png`
            let buildParams = `--arch=${settings.BUILD_ARCH} --asar --overwrite --platform=${settings.BUILD_PLATFORM} --prune=true`
            // This is broken when used in combination with Wine due to rcedit.
            // See: https://github.com/electron-userland/electron-packager/issues/769
            if (settings.BUILD_PLATFORM !== 'win32') buildParams += iconParam
            const distBuildName = `${settings.BRAND_TARGET}-${settings.BUILD_PLATFORM}-${settings.BUILD_ARCH}`
            let execCommand = `electron-packager ${buildDir} ${settings.BRAND_TARGET} ${buildParams} --out=${distDir}`
            childExec(execCommand, undefined, (err, stdout, stderr) => {
                if (stderr) gutil.log(stderr)
                if (stdout) gutil.log(stdout)
                archive.directory(path.join(distDir, distBuildName), distBuildName)
                archive.finalize()
            })
        }
    })
}, {options: taskOptions.all})


gulp.task('build-run', 'Make a development build and run it in the target environment.', () => {
    let command = `gulp build --target ${settings.BUILD_TARGET} --brand ${settings.BRAND_TARGET}`
    const buildDir = `./build/${settings.BRAND_TARGET}/${settings.BUILD_TARGET}`
    if (settings.BUILD_TARGET === 'chrome') command = `${command};chromium --user-data-dir=/tmp/vialer-js --load-extension=${buildDir} --no-first-run`
    else if (settings.BUILD_TARGET === 'firefox') command = `${command};web-ext run --no-reload --source-dir ${buildDir}`
    else if (settings.BUILD_TARGET === 'electron') {
        command = `${command};electron --js-flags='--harmony-async-await' ${buildDir}/main.js`
    } else if (settings.BUILD_TARGET === 'webview') {
        helpers.startDevServer()
        const urlTarget = `http://localhost:8999/${settings.BRAND_TARGET}/webview/index.html`
        command = `${command};chromium --disable-web-security --new-window ${urlTarget}`
    }
    childExec(command, undefined, (err, stdout, stderr) => {
        if (err) gutil.log(err)
    })
}, {options: taskOptions.all})


gulp.task('deploy', 'Deploy &lt;BRAND_TARGET> to the &lt;BUILD_TARGET> store.', async() => {
    await helpers.deploy(settings.BRAND_TARGET, settings.BUILD_TARGET, helpers.distributionName(settings.BRAND_TARGET))
}, {options: taskOptions.browser})


gulp.task('deploy-brand', 'Deploy &lt;BRAND_TARGET> to all supported target stores.', async() => {
    const targets = ['chrome', 'firefox']
    for (const target of targets) {
        await helpers.deploy(settings.BRAND_TARGET, target, helpers.distributionName(settings.BRAND_TARGET))
    }
}, {options: taskOptions.brandOnly})


gulp.task('deploy-brands', 'Deploy all brands to &lt;BUILD_TARGET> store.', async() => {
    // Can't do this async, since settings are modified during deploy to work
    // around gulp tasks not accepting parameters.
    for (const brand of Object.keys(settings.brands)) {
        await helpers.deploy(brand, settings.BUILD_TARGET, helpers.distributionName(brand))
    }
}, {options: taskOptions.targetOnly})


gulp.task('deploy-brands-targets', 'Deploy all brands to all supported target stores.', async() => {
    const targets = ['chrome', 'firefox']
    for (const target of targets) {
        for (const brand of Object.keys(settings.brands)) {
            await helpers.deploy(brand, target, helpers.distributionName(brand))
        }
    }
})


gulp.task('docs', 'Generate docs.', (done) => {
    let execCommand = `node ${settings.NODE_PATH}/jsdoc/jsdoc.js ./ -R ./README.md -c ./.jsdoc.json -d ${settings.BUILD_DIR}/docs --package ./package.json`
    childExec(execCommand, undefined, (err, stdout, stderr) => {
        if (stderr) gutil.log(stderr)
        if (stdout) gutil.log(stdout)
        if (settings.LIVERELOAD) livereload.changed('rtd.js')
        done()
    })
})


gulp.task('docs-deploy', 'Publish docs on github pages.', ['docs'], () => {
    return gulp.src(path.join(settings.BUILD_DIR, 'docs', '**', '*')).pipe(ghPages())
})


gulp.task('html', 'Preprocess and build application HTML.', () => {
    let jsbottom

    // Scripts are combined
    if (['electron', 'webview'].includes(settings.BUILD_TARGET)) {
        jsbottom = '&lt;script src="js/app_bg.js">&lt;/script>&lt;script src="js/app_fg.js">&lt;/script>'
    } else {
        jsbottom = '&lt;script src="js/app_fg.js">&lt;/script>'
    }

    // The index.html file is shared with the electron build target.
    // Appropriate scripts are inserted based on the build target.
    return gulp.src(path.join('src', 'index.html'))
        .pipe(replace('&lt;!--JSBOTTOM-->', jsbottom))
        .pipe(flatten())
        .pipe(gulp.dest(`./build/${settings.BRAND_TARGET}/${settings.BUILD_TARGET}`))
        .pipe(ifElse(settings.LIVERELOAD, livereload))
}, {options: taskOptions.all})


gulp.task('__tmp-icons', 'Copy default SVG icons and brand icons to a temp dir.', (done) => {
    return gulp.src('./src/svg/*.svg', {base: 'src'})
        .pipe(addsrc(`./src/brand/${settings.BRAND_TARGET}/svg/*.svg`, {base: `./src/brand/${settings.BRAND_TARGET}/`}))
        .pipe(gulp.dest(path.join(settings.TEMP_DIR, settings.BRAND_TARGET)))
        .pipe(svgo())
        .pipe(size(_extend({title: 'icons'}, settings.SIZE_OPTIONS)))
})


/**
* Process all images with Vue-svgicon into Javascript Vue components,
* which can be included as regular components.
* TODO: Integrate vue-svgicon with Gulp.
*/
gulp.task('icons', 'Build an SVG iconset.', ['__tmp-icons'], (done) => {
    const srcDir = path.join(settings.TEMP_DIR, settings.BRAND_TARGET, 'svg')
    // The icons JavaScript is added inside the source.
    const srcBuildDir = path.join(settings.SRC_DIR, 'brand', settings.BRAND_TARGET, 'icons')
    let execCommand = `node_modules/vue-svgicon/bin/svg.js -s ${srcDir} -t ${srcBuildDir}`
    childExec(execCommand, undefined, (_err, stdout, stderr) => {
        if (stderr) gutil.log(stderr)
        if (stdout) gutil.log(stdout)
        done()
    })

}, {options: taskOptions.all})


gulp.task('js-electron', 'Generate Electron application.', (done) => {
    const settingsFile = path.join(__dirname, 'build', settings.BRAND_TARGET, settings.BUILD_TARGET, 'settings.json')
    runSequence([
        'js-vendor',
        'js-app-bg',
        'js-app-fg',
        'js-electron-main',
    ], async() => {
        // Vendor-specific info for Electron's main.js file.
        let mainSettings = {
            name: settings.brands[settings.BRAND_TARGET].name[settings.DEPLOY_TARGET],
            vendor: settings.brands[settings.BRAND_TARGET].vendor,
        }
        await writeFileAsync(settingsFile, JSON.stringify(mainSettings))
        done()
    })
})


gulp.task('js-electron-main', 'Copy Electron main thread js to build.', ['js-app-bg', 'js-app-fg'], () => {
    return gulp.src('./src/js/main.js', {base: './src/js/'})
        .pipe(gulp.dest(`./build/${settings.BRAND_TARGET}/${settings.BUILD_TARGET}`))
        .pipe(size(_extend({title: 'electron-main'}, settings.SIZE_OPTIONS)))
        .pipe(ifElse(settings.LIVERELOAD, livereload))
})


gulp.task('js-vendor', 'Generate third-party vendor js.', ['icons'], (done) => {
    helpers.jsEntry(
        settings.BRAND_TARGET, settings.BUILD_TARGET, 'vendor', 'vendor',
        [`./src/brand/${settings.BRAND_TARGET}/icons/index.js`],
        () => {
            if (settings.LIVERELOAD) livereload.changed('web.js')
            done()
        }
    )
}, {options: taskOptions.all})


gulp.task('js-app-bg', 'Generate the extension background entry js.', (done) => {
    helpers.jsEntry(settings.BRAND_TARGET, settings.BUILD_TARGET, 'bg/index', 'app_bg', [], () => {
        if (settings.LIVERELOAD) livereload.changed('web.js')
        done()
    })
}, {options: taskOptions.browser})


gulp.task('js-app-fg', 'Generate webextension fg/popout js.', (done) => {
    helpers.jsEntry(settings.BRAND_TARGET, settings.BUILD_TARGET, 'fg/index', 'app_fg', [], () => {
        if (settings.LIVERELOAD) livereload.changed('web.js')
        done()
    })
}, {options: taskOptions.browser})


gulp.task('js-app-observer', 'Generate WebExtension icon observer which runs in all tab frames.', (done) => {
    helpers.jsEntry(settings.BRAND_TARGET, settings.BUILD_TARGET, 'observer/index', 'app_observer', [], () => {
        done()
    })
}, {options: taskOptions.browser})


gulp.task('manifest', 'Create a browser-specific manifest file.', async() => {
    let manifest = helpers.getManifest(settings.BRAND_TARGET, settings.BUILD_TARGET)
    const manifestTarget = path.join(__dirname, 'build', settings.BRAND_TARGET, settings.BUILD_TARGET, 'manifest.json')
    await mkdirp(path.join(settings.BUILD_DIR, settings.BRAND_TARGET, settings.BUILD_TARGET))
    await writeFileAsync(manifestTarget, JSON.stringify(manifest, null, 4))
}, {options: taskOptions.browser})


gulp.task('scss', 'Compile all css.', [], (done) => {
    runSequence([
        'scss-app',
        'scss-observer',
    ], () => {
        // Targetting webext.css for livereload changed only works in the
        // webview.
        if (settings.LIVERELOAD) livereload.changed('app.css')
        done()
    })
}, {options: taskOptions.all})


gulp.task('scss-app', 'Generate application css.', () => {
    return helpers.scssEntry(
        settings.BRAND_TARGET,
        settings.BUILD_TARGET,
        'app',
        !settings.PRODUCTION,
        // Mixin the component scss.
        path.join(settings.SRC_DIR, 'components', '**', '*.scss'))
}, {options: taskOptions.all})


gulp.task('scss-observer', 'Generate observer css.', () => {
    return helpers.scssEntry(settings.BRAND_TARGET, settings.BUILD_TARGET, 'observer', !settings.PRODUCTION)
}, {options: taskOptions.all})


gulp.task('scss-vendor', 'Generate vendor css.', () => {
    return helpers.scssEntry(settings.BRAND_TARGET, settings.BUILD_TARGET, 'vendor', false)
}, {options: taskOptions.all})


gulp.task('templates', 'Build Vue component templates', () => {
    gulp.src('./src/components/**/*.vue')
        .pipe(fuet({
            commonjs: false,
            namespace: 'global.templates',
            pathfilter: ['src', 'components'],
        }))
        .on('error', notify.onError('Error: &lt;%= error.message %>'))
        .pipe(ifElse(settings.PRODUCTION, () => minifier()))
        .on('end', () => {
            if (settings.LIVERELOAD) livereload.changed('templates.js')
        })
        .pipe(concat('templates.js'))
        .pipe(insert.prepend('global.templates={};'))
        .pipe(gulp.dest(path.join(settings.BUILD_DIR, settings.BRAND_TARGET, settings.BUILD_TARGET, 'js')))
        .pipe(size(_extend({title: 'templates'}, settings.SIZE_OPTIONS)))
})


gulp.task('test', function() {
    return gulp.src('test/**/*.js')
        .pipe(tape({
            outputStream: test.createStream().pipe(colorize()).pipe(process.stdout),
        }))
})


gulp.task('translations', 'Generate translations', (done) => {
    return gulp.src('./src/js/i18n/*.js', {base: './src/js/'})
        .pipe(concat('translations.js'))
        .pipe(ifElse(settings.PRODUCTION, () => minifier()))
        .pipe(gulp.dest(path.join(settings.BUILD_DIR, settings.BRAND_TARGET, settings.BUILD_TARGET, 'js')))
        .pipe(size(_extend({title: 'js-translations'}, settings.SIZE_OPTIONS)))
        .pipe(ifElse(settings.LIVERELOAD, livereload))
})


gulp.task('watch', 'Start development server and watch for changes.', () => {
    settings.LIVERELOAD = true
    helpers.startDevServer()

    // Watch files related to working on the documentation.
    if (WITHDOCS) {
        gutil.log('Watching documentation')
        gulp.watch([
            path.join(__dirname, '.jsdoc.json'),
            path.join(__dirname, 'README.md'),
            path.join(__dirname, 'docs', 'manuals', '**'),
        ], () => {
            gulp.start('docs')
        })
    }


    if (settings.BUILD_TARGET === 'node') {
        // Node development doesn't require transpilation.
        gulp.watch([path.join(__dirname, 'src', 'js', '**', '*.js')], ['test'])
    } else {
        gulp.watch([
            path.join(__dirname, 'src', 'components', '**', '*.js'),
            path.join(__dirname, 'src', 'js', 'lib', '**', '*.js'),
            path.join(__dirname, 'src', 'js', 'fg', '**', '*.js'),
        ], WITHDOCS ? ['js-app-fg', 'docs'] : ['js-app-fg'])

        gulp.watch([
            path.join(__dirname, 'src', 'js', 'bg', '**', '*.js'),
            path.join(__dirname, 'src', 'js', 'lib', '**', '*.js'),
        ], WITHDOCS ? ['js-app-bg', 'docs'] : ['js-app-bg'])

        gulp.watch([
            path.join(__dirname, 'src', 'js', 'observer', '**', '*.js'),
            path.join(__dirname, 'src', 'js', 'lib', '**', '*.js'),
        ], WITHDOCS ? ['js-app-observer', 'docs'] : ['js-app-observer'])

        if (settings.BUILD_TARGET === 'electron') {
            gulp.watch([path.join(__dirname, 'src', 'js', 'main.js')], ['js-electron'])
        }
    }

    gulp.watch(path.join(__dirname, 'src', 'js', 'vendor.js'), ['js-vendor'])

    if (!['electron', 'webview'].includes(settings.BUILD_TARGET)) {
        gulp.watch(path.join(__dirname, 'src', 'manifest.json'), ['manifest'])
        gulp.watch(path.join(__dirname, 'src', 'brand.json'), ['build'])
    }

    // Watch files related to working on assets.
    gulp.watch([
        path.join(__dirname, 'src', '_locales', '**', '*.json'),
        path.join(__dirname, 'src', 'js', 'lib', 'thirdparty', '**', '*.js'),
    ], ['assets'])

    // Watch files related to working on the html and css.
    gulp.watch(path.join(__dirname, 'src', 'index.html'), ['html'])
    gulp.watch([
        path.join(__dirname, 'src', 'scss', '**', '*.scss'),
        `!${path.join(__dirname, 'src', 'scss', 'observer.scss')}`,
        path.join(__dirname, 'src', 'components', '**', '*.scss'),
    ], ['scss-app'])

    gulp.watch(path.join(__dirname, 'src', 'scss', 'observer.scss'), ['scss-observer'])
    gulp.watch(path.join(__dirname, 'src', 'scss', 'vendor.scss'), ['scss-vendor'])

    gulp.watch(path.join(__dirname, 'src', 'components', '**', '*.vue'), ['templates'])
    gulp.watch(path.join(__dirname, 'src', 'js', 'i18n', '**', '*.js'), ['translations'])
    gulp.watch(path.join(__dirname, 'test', '**', '*.js'), ['test'])


    // Add linked packages here that are used during development.
    if (WATCHLINKED) {
        gutil.log('Watching linked development packages')
        gulp.watch([
            path.join(settings.NODE_PATH, 'jsdoc-rtd', 'static', 'styles', '*.css'),
            path.join(settings.NODE_PATH, 'jsdoc-rtd', 'static', 'js', '*.js'),
            path.join(settings.NODE_PATH, 'jsdoc-rtd', 'publish.js'),
            path.join(settings.NODE_PATH, 'jsdoc-rtd', 'tmpl', '**', '*.tmpl'),
        ], ['docs'])

        gulp.watch([
            path.join(settings.NODE_PATH, 'fuet-notify', 'src', 'js', '*.js'),
        ], ['js-vendor'])
    }
})
</code></pre>
</article>





        <hr>
        <footer>
            <strong>&copy; Devhouse Spindle</strong><br/>
            Documented with <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.5.5</a>
        </footer>
    </div>
</div>

<script src="js/jquery.min.js"></script>
<script>

window.isApi = true
window.isManual = false
window.doc = {
    name: '',
    longname: '',
}

if (!doc.name) isApi = false

</script>
<script src="js/rtd.js"></script>
</body>
</html>
